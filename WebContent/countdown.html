<!DOCTYPE HTML>

<html>
<head>
<title>Countdown Timer</title>
<link rel="stylesheet" type="text/css" href="countdown.css"></link>
</head>
<body>
	<header>
		<div id="nav-bar">
			
		</div>
	</header>
	<div class="container">
		<div id="timer-box">
			<label id="time"></label>
			<div id="input-box">
				<label>Hours:</label> <input id="input-hrs" type="number" min="0"
					max="23"> <label>Minutes:</label> <input id="input-mins"
					type="number" min="0" max="59"> <label>Seconds:</label> <input
					id="input-secs" type="number" min="0" max="59">
			</div>
			<div id="button-box">
				<input id="start-timer" type="button" value="Start">
			</div>
		</div>
	</div>
	<script>
		/*
			TODO: Alert the user with a sound effect when the timer has ended.
		*/
		document.body.onkeydown = function(e){
			if (e.key == 'Enter'){
				startTimer();
			}
		}
		var number_inputs = document.querySelectorAll("input[type='number']");
		
		for (input of number_inputs){
			input.defaultValue = 0;
		}
		
		var counter = 0;

		var timeLabel = document.getElementById("time");
		timeLabel.innerText = formatMilliseconds(counter * 1000);
		
		var startTimerBtn = document.getElementById("start-timer");
		
		var timer;
		startTimerBtn.onclick = function (){
			startTimer();
		}
		
		function startTimer(){
			clearInterval(timer);
			counter = 0;
			timeLabel.style.color = '';
			
			var hrs = parseInt(number_inputs[0].value);
			var mins = parseInt(number_inputs[1].value);
			var seconds = parseInt(number_inputs[2].value);

			if (isNaN(hrs) || hrs < 0 || hrs > 23){
				alert("Hours is invalid");
				return;
			} else if (isNaN(mins) || mins < 0 || mins > 59){
				alert("Minutes is invalid");
				return;
			} else if (isNaN(seconds) || seconds < 0 || seconds > 59){
				alert("Seconds is invalid");
				return;
			}
			
			var totalSeconds = parseInt((hrs * 60) * 60) + parseInt(mins * 60) + seconds;
			counter = totalSeconds;
		
			if (counter <= 0){
				alert("Cant start from 0");
				return;
			}
			
			counter--;
			
			timeLabel.innerText = formatMilliseconds(counter * 1000);
			
			if (counter < 10){
				timeLabel.style.color = 'red';
			}
			
			timer = setInterval(elapsed ,1000);
		}
		
		function elapsed(){
			counter--;
			if (counter < 0) {
				clearInterval(timer);
				future();
			} else {
				if (counter < 10){
					timeLabel.style.color = 'red';
				}
				timeLabel.innerText = formatMilliseconds(counter * 1000);
			}
		}
		
		
		function future(){
			alert("TIME UP!!!");
		}
		
		function formatMilliseconds(milli) {
			var seconds = parseInt(milli / 1000);
			var minutes = parseInt(seconds / 60);
			var hours = parseInt(minutes / 60);
			var hrs = formatNum(hours % 24);
			var mins = formatNum(minutes % 60);
			var secs = formatNum(seconds % 60);
			return `${hrs}:${mins}:${secs}`;
		}

		function formatNum(n) {
			return n < 10 ? "0" + n : n;
		}
	</script>
</body>
</html>